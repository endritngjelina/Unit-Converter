<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit Converter Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --background: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .converter-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
        }

        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .category-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: var(--background);
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .category-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .category-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow);
        }

        .converter-form {
            display: grid;
            gap: 25px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            align-items: end;
        }

        .form-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-field label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .form-field input,
        .form-field select {
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-field input:focus,
        .form-field select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .swap-btn {
            background: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 1.2rem;
            margin: 20px auto;
        }

        .swap-btn:hover {
            background: var(--primary-dark);
            transform: rotate(180deg);
        }

        .result-display {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            margin-top: 20px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .result-units {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .favorites-panel,
        .history-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-lg);
        }

        .panel-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .clear-btn {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .history-item,
        .favorite-item {
            background: var(--background);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .history-item:hover,
        .favorite-item:hover {
            background: #f1f5f9;
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }

        .history-conversion {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .history-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .keyboard-shortcuts {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-lg);
            margin-top: 20px;
        }

        .shortcut-item {
            display: flex;
            justify-content: between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .shortcut-item:last-child {
            border-bottom: none;
        }

        .shortcut-key {
            background: var(--background);
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            transform: translateX(300px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .precision-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .precision-control label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .precision-slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .category-selector {
                justify-content: center;
            }
            
            .input-group {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .error-message {
            background: #fee2e2;
            color: var(--error-color);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Unit Converter Pro</h1>
            <p>Professional-grade conversion tool with advanced features</p>
        </header>

        <main class="main-content">
            <div class="converter-panel">
                <div class="category-selector" id="categorySelector">
                    <button class="category-btn active" data-category="length">📏 Length</button>
                    <button class="category-btn" data-category="weight">⚖️ Weight</button>
                    <button class="category-btn" data-category="temperature">🌡️ Temperature</button>
                    <button class="category-btn" data-category="area">📐 Area</button>
                    <button class="category-btn" data-category="volume">🧪 Volume</button>
                    <button class="category-btn" data-category="speed">🚀 Speed</button>
                    <button class="category-btn" data-category="energy">⚡ Energy</button>
                    <button class="category-btn" data-category="pressure">💨 Pressure</button>
                </div>

                <form class="converter-form" id="converterForm">
                    <div class="input-group">
                        <div class="form-field">
                            <label for="fromValue">From Value</label>
                            <input type="number" id="fromValue" step="any" placeholder="Enter value to convert" autocomplete="off">
                        </div>
                        <div class="form-field">
                            <label for="fromUnit">From Unit</label>
                            <select id="fromUnit"></select>
                        </div>
                    </div>

                    <button type="button" class="swap-btn" id="swapBtn" title="Swap units (Ctrl+S)">⇄</button>

                    <div class="input-group">
                        <div class="form-field">
                            <label for="toValue">To Value</label>
                            <input type="number" id="toValue" readonly placeholder="Converted value">
                        </div>
                        <div class="form-field">
                            <label for="toUnit">To Unit</label>
                            <select id="toUnit"></select>
                        </div>
                    </div>

                    <div class="precision-control">
                        <label>Precision:</label>
                        <input type="range" class="precision-slider" id="precisionSlider" min="0" max="10" value="4">
                        <span id="precisionValue">4</span>
                    </div>

                    <div class="result-display" id="resultDisplay" style="display: none;">
                        <div class="result-value" id="resultValue">0</div>
                        <div class="result-units" id="resultUnits"></div>
                    </div>
                </form>
            </div>

            <div class="sidebar">
                <div class="favorites-panel">
                    <div class="panel-header">
                        <h3 class="panel-title">⭐ Quick Conversions</h3>
                        <button class="clear-btn" id="clearFavorites">Clear</button>
                    </div>
                    <div id="favoritesList">
                        <div class="favorite-item" data-conversion="length,1,meter,foot">1 meter = 3.2808 feet</div>
                        <div class="favorite-item" data-conversion="weight,1,kilogram,pound">1 kg = 2.2046 pounds</div>
                        <div class="favorite-item" data-conversion="temperature,0,celsius,fahrenheit">0°C = 32°F</div>
                    </div>
                </div>

                <div class="history-panel">
                    <div class="panel-header">
                        <h3 class="panel-title">🕒 Recent History</h3>
                        <button class="clear-btn" id="clearHistory">Clear</button>
                    </div>
                    <div id="historyList">
                        <p style="color: var(--text-secondary); text-align: center; padding: 20px;">No conversions yet</p>
                    </div>
                </div>

                <div class="keyboard-shortcuts">
                    <h4 class="panel-title" style="margin-bottom: 15px;">⌨️ Shortcuts</h4>
                    <div class="shortcut-item">
                        <span>Focus input</span>
                        <span class="shortcut-key">Ctrl+I</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Swap units</span>
                        <span class="shortcut-key">Ctrl+S</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Clear all</span>
                        <span class="shortcut-key">Ctrl+R</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Save to favorites</span>
                        <span class="shortcut-key">Ctrl+F</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        class UnitConverterPro {
            constructor() {
                this.currentCategory = 'length';
                this.conversionHistory = this.loadFromStorage('conversionHistory', []);
                this.favorites = this.loadFromStorage('favorites', []);
                this.precision = 4;
                
                this.units = {
                    length: {
                        meter: 1,
                        kilometer: 0.001,
                        centimeter: 100,
                        millimeter: 1000,
                        inch: 39.3701,
                        foot: 3.28084,
                        yard: 1.09361,
                        mile: 0.000621371,
                        nauticalMile: 0.000539957
                    },
                    weight: {
                        kilogram: 1,
                        gram: 1000,
                        pound: 2.20462,
                        ounce: 35.274,
                        ton: 0.001,
                        stone: 0.157473,
                        shortTon: 0.00110231,
                        longTon: 0.000984207
                    },
                    temperature: {
                        celsius: (c) => c,
                        fahrenheit: (c) => (c * 9/5) + 32,
                        kelvin: (c) => c + 273.15,
                        rankine: (c) => (c + 273.15) * 9/5
                    },
                    area: {
                        squareMeter: 1,
                        squareKilometer: 0.000001,
                        squareCentimeter: 10000,
                        squareInch: 1550.0031,
                        squareFoot: 10.7639,
                        squareYard: 1.19599,
                        acre: 0.000247105,
                        hectare: 0.0001
                    },
                    volume: {
                        liter: 1,
                        milliliter: 1000,
                        gallon: 0.264172,
                        quart: 1.05669,
                        pint: 2.11338,
                        cup: 4.22675,
                        fluidOunce: 33.814,
                        tablespoon: 67.628,
                        teaspoon: 202.884,
                        cubicMeter: 0.001,
                        cubicCentimeter: 1000
                    },
                    speed: {
                        meterPerSecond: 1,
                        kilometerPerHour: 3.6,
                        milePerHour: 2.23694,
                        knot: 1.94384,
                        footPerSecond: 3.28084
                    },
                    energy: {
                        joule: 1,
                        kilojoule: 0.001,
                        calorie: 0.239006,
                        kilocalorie: 0.000239006,
                        wattHour: 0.000277778,
                        kilowattHour: 2.77778e-7,
                        btu: 0.000947817
                    },
                    pressure: {
                        pascal: 1,
                        kilopascal: 0.001,
                        bar: 0.00001,
                        atmosphere: 0.00000986923,
                        psi: 0.000145038,
                        torr: 0.00750062,
                        mmHg: 0.00750062
                    }
                };

                this.unitLabels = {
                    length: {
                        meter: 'Meter (m)',
                        kilometer: 'Kilometer (km)',
                        centimeter: 'Centimeter (cm)',
                        millimeter: 'Millimeter (mm)',
                        inch: 'Inch (in)',
                        foot: 'Foot (ft)',
                        yard: 'Yard (yd)',
                        mile: 'Mile (mi)',
                        nauticalMile: 'Nautical Mile'
                    },
                    weight: {
                        kilogram: 'Kilogram (kg)',
                        gram: 'Gram (g)',
                        pound: 'Pound (lb)',
                        ounce: 'Ounce (oz)',
                        ton: 'Metric Ton',
                        stone: 'Stone',
                        shortTon: 'Short Ton',
                        longTon: 'Long Ton'
                    },
                    temperature: {
                        celsius: 'Celsius (°C)',
                        fahrenheit: 'Fahrenheit (°F)',
                        kelvin: 'Kelvin (K)',
                        rankine: 'Rankine (°R)'
                    },
                    area: {
                        squareMeter: 'Square Meter (m²)',
                        squareKilometer: 'Square Kilometer (km²)',
                        squareCentimeter: 'Square Centimeter (cm²)',
                        squareInch: 'Square Inch (in²)',
                        squareFoot: 'Square Foot (ft²)',
                        squareYard: 'Square Yard (yd²)',
                        acre: 'Acre',
                        hectare: 'Hectare'
                    },
                    volume: {
                        liter: 'Liter (L)',
                        milliliter: 'Milliliter (mL)',
                        gallon: 'US Gallon',
                        quart: 'US Quart',
                        pint: 'US Pint',
                        cup: 'US Cup',
                        fluidOunce: 'US Fluid Ounce',
                        tablespoon: 'US Tablespoon',
                        teaspoon: 'US Teaspoon',
                        cubicMeter: 'Cubic Meter (m³)',
                        cubicCentimeter: 'Cubic Centimeter (cm³)'
                    },
                    speed: {
                        meterPerSecond: 'Meter/Second (m/s)',
                        kilometerPerHour: 'Kilometer/Hour (km/h)',
                        milePerHour: 'Mile/Hour (mph)',
                        knot: 'Knot',
                        footPerSecond: 'Foot/Second (ft/s)'
                    },
                    energy: {
                        joule: 'Joule (J)',
                        kilojoule: 'Kilojoule (kJ)',
                        calorie: 'Calorie (cal)',
                        kilocalorie: 'Kilocalorie (kcal)',
                        wattHour: 'Watt Hour (Wh)',
                        kilowattHour: 'Kilowatt Hour (kWh)',
                        btu: 'British Thermal Unit (BTU)'
                    },
                    pressure: {
                        pascal: 'Pascal (Pa)',
                        kilopascal: 'Kilopascal (kPa)',
                        bar: 'Bar',
                        atmosphere: 'Atmosphere (atm)',
                        psi: 'PSI',
                        torr: 'Torr',
                        mmHg: 'mmHg'
                    }
                };

                this.initializeElements();
                this.attachEventListeners();
                this.setupKeyboardShortcuts();
                this.populateUnits();
                this.renderHistory();
                this.renderFavorites();
            }

            initializeElements() {
                this.elements = {
                    categorySelector: document.getElementById('categorySelector'),
                    fromValue: document.getElementById('fromValue'),
                    fromUnit: document.getElementById('fromUnit'),
                    toValue: document.getElementById('toValue'),
                    toUnit: document.getElementById('toUnit'),
                    swapBtn: document.getElementById('swapBtn'),
                    resultDisplay: document.getElementById('resultDisplay'),
                    resultValue: document.getElementById('resultValue'),
                    resultUnits: document.getElementById('resultUnits'),
                    historyList: document.getElementById('historyList'),
                    favoritesList: document.getElementById('favoritesList'),
                    clearHistory: document.getElementById('clearHistory'),
                    clearFavorites: document.getElementById('clearFavorites'),
                    precisionSlider: document.getElementById('precisionSlider'),
                    precisionValue: document.getElementById('precisionValue'),
                    toast: document.getElementById('toast')
                };
            }

            attachEventListeners() {
                // Category selection
                this.elements.categorySelector.addEventListener('click', (e) => {
                    if (e.target.classList.contains('category-btn')) {
                        this.switchCategory(e.target.dataset.category);
                    }
                });

                // Real-time conversion
                this.elements.fromValue.addEventListener('input', () => this.convert());
                this.elements.fromUnit.addEventListener('change', () => this.convert());
                this.elements.toUnit.addEventListener('change', () => this.convert());

                // Swap units
                this.elements.swapBtn.addEventListener('click', () => this.swapUnits());

                // Precision control
                this.elements.precisionSlider.addEventListener('input', (e) => {
                    this.precision = parseInt(e.target.value);
                    this.elements.precisionValue.textContent = this.precision;
                    this.convert();
                });

                // History and favorites
                this.elements.clearHistory.addEventListener('click', () => this.clearHistory());
                this.elements.clearFavorites.addEventListener('click', () => this.clearFavorites());

                // History item clicks
                this.elements.historyList.addEventListener('click', (e) => {
                    const item = e.target.closest('.history-item');
                    if (item) this.loadFromHistory(item);
                });

                // Favorite item clicks
                this.elements.favoritesList.addEventListener('click', (e) => {
                    const item = e.target.closest('.favorite-item');
                    if (item) this.loadFromFavorite(item);
                });

                // Auto-focus and formatting
                this.elements.fromValue.addEventListener('focus', () => {
                    this.elements.fromValue.select();
                });
            }

            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key.toLowerCase()) {
                            case 'i':
                                e.preventDefault();
                                this.elements.fromValue.focus();
                                break;
                            case 's':
                                e.preventDefault();
                                this.swapUnits();
                                break;
                            case 'r':
                                e.preventDefault();
                                this.clearAll();
                                break;
                            case 'f':
                                e.preventDefault();
                                this.addToFavorites();
                                break;
                        }
                    }
                });
            }

            switchCategory(category) {
                this.currentCategory = category;
                
                // Update active button
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.category === category);
                });

                this.populateUnits();
                this.convert();
            }

            populateUnits() {
                const units = this.units[this.currentCategory];
                const labels = this.unitLabels[this.currentCategory];
                
                // Clear existing options
                this.elements.fromUnit.innerHTML = '';
                this.elements.toUnit.innerHTML = '';

                // Populate dropdowns
                Object.keys(units).forEach(unit => {
                    const option1 = new Option(labels[unit], unit);
                    const option2 = new Option(labels[unit], unit);
                    this.elements.fromUnit.add(option1);
                    this.elements.toUnit.add(option2);
                });

                // Set default selections
                if (this.elements.fromUnit.options.length > 0) {
                    this.elements.fromUnit.selectedIndex = 0;
                    this.elements.toUnit.selectedIndex = Math.min(1, this.elements.toUnit.options.length - 1);
                }
            }

            convert() {
                const value = parseFloat(this.elements.fromValue.value);
                const fromUnit = this.elements.fromUnit.value;
                const toUnit = this.elements.toUnit.value;

                if (!value || isNaN(value) || !fromUnit || !toUnit) {
                    this.elements.toValue.value = '';
                    this.elements.resultDisplay.style.display = 'none';
                    return;
                }

                let result;

                if (this.currentCategory === 'temperature') {
                    result = this.convertTemperature(value, fromUnit, toUnit);
                } else {
                    const units = this.units[this.currentCategory];
                    const baseValue = value / units[fromUnit];
                    result = baseValue * units[toUnit];
                }

                const roundedResult = parseFloat(result.toFixed(this.precision));
                
                this.elements.toValue.value = roundedResult;
                this.elements.resultValue.textContent = this.formatNumber(roundedResult);
                this.elements.resultUnits.textContent = this.unitLabels[this.currentCategory][toUnit];
                this.elements.resultDisplay.style.display = 'block';

                // Add to history
                this.addToHistory(value, fromUnit, roundedResult, toUnit);
            }

            convertTemperature(value, fromUnit, toUnit) {
                // Convert to Celsius first
                let celsius;
                switch (fromUnit) {
                    case 'celsius':
                        celsius = value;
                        break;
                    case 'fahrenheit':
                        celsius = (value - 32) * 5/9;
                        break;
                    case 'kelvin':
                        celsius = value - 273.15;
                        break;
                    case 'rankine':
                        celsius = (value - 491.67) * 5/9;
                        break;
                }

                // Convert from Celsius to target unit
                switch (toUnit) {
                    case 'celsius':
                        return celsius;
                    case 'fahrenheit':
                        return (celsius * 9/5) + 32;
                    case 'kelvin':
                        return celsius + 273.15;
                    case 'rankine':
                        return (celsius + 273.15) * 9/5;
                }
            }

            swapUnits() {
                const fromUnit = this.elements.fromUnit.value;
                const toUnit = this.elements.toUnit.value;
                const fromValue = this.elements.fromValue.value;
                const toValue = this.elements.toValue.value;

                this.elements.fromUnit.value = toUnit;
                this.elements.toUnit.value = fromUnit;
                this.elements.fromValue.value = toValue;
                
                this.convert();
                this.showToast('Units swapped successfully!');
            }

            addToHistory(fromValue, fromUnit, toValue, toUnit) {
                const conversion = {
                    category: this.currentCategory,
                    fromValue,
                    fromUnit,
                    toValue,
                    toUnit,
                    timestamp: new Date().toISOString()
                };

                // Remove duplicates and add to beginning
                this.conversionHistory = this.conversionHistory.filter(item => 
                    !(item.category === conversion.category &&
                      item.fromValue === conversion.fromValue &&
                      item.fromUnit === conversion.fromUnit &&
                      item.toUnit === conversion.toUnit)
                );
                
                this.conversionHistory.unshift(conversion);
                
                // Limit history to 50 items
                if (this.conversionHistory.length > 50) {
                    this.conversionHistory = this.conversionHistory.slice(0, 50);
                }
                
                this.saveToStorage('conversionHistory', this.conversionHistory);
                this.renderHistory();
            }

            addToFavorites() {
                const fromValue = parseFloat(this.elements.fromValue.value);
                const fromUnit = this.elements.fromUnit.value;
                const toValue = parseFloat(this.elements.toValue.value);
                const toUnit = this.elements.toUnit.value;

                if (!fromValue || !fromUnit || !toValue || !toUnit) {
                    this.showToast('Please complete a conversion first!', 'warning');
                    return;
                }

                const favorite = {
                    category: this.currentCategory,
                    fromValue,
                    fromUnit,
                    toValue,
                    toUnit,
                    label: `${fromValue} ${this.getUnitSymbol(fromUnit)} = ${this.formatNumber(toValue)} ${this.getUnitSymbol(toUnit)}`
                };

                // Check for duplicates
                const exists = this.favorites.some(fav =>
                    fav.category === favorite.category &&
                    fav.fromValue === favorite.fromValue &&
                    fav.fromUnit === favorite.fromUnit &&
                    fav.toUnit === favorite.toUnit
                );

                if (!exists) {
                    this.favorites.unshift(favorite);
                    this.saveToStorage('favorites', this.favorites);
                    this.renderFavorites();
                    this.showToast('Added to favorites!', 'success');
                } else {
                    this.showToast('Already in favorites!', 'warning');
                }
            }

            getUnitSymbol(unit) {
                const symbolMap = {
                    // Length
                    meter: 'm', kilometer: 'km', centimeter: 'cm', millimeter: 'mm',
                    inch: 'in', foot: 'ft', yard: 'yd', mile: 'mi',
                    // Weight
                    kilogram: 'kg', gram: 'g', pound: 'lb', ounce: 'oz',
                    // Temperature
                    celsius: '°C', fahrenheit: '°F', kelvin: 'K', rankine: '°R',
                    // Area
                    squareMeter: 'm²', squareKilometer: 'km²', squareFoot: 'ft²',
                    // Volume
                    liter: 'L', milliliter: 'mL', gallon: 'gal',
                    // Speed
                    meterPerSecond: 'm/s', kilometerPerHour: 'km/h', milePerHour: 'mph',
                    // Energy
                    joule: 'J', kilojoule: 'kJ', kilowattHour: 'kWh',
                    // Pressure
                    pascal: 'Pa', bar: 'bar', psi: 'psi'
                };
                return symbolMap[unit] || unit;
            }

            renderHistory() {
                if (this.conversionHistory.length === 0) {
                    this.elements.historyList.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No conversions yet</p>';
                    return;
                }

                this.elements.historyList.innerHTML = this.conversionHistory.slice(0, 10).map(item => {
                    const timeAgo = this.getTimeAgo(new Date(item.timestamp));
                    return `
                        <div class="history-item" data-history='${JSON.stringify(item)}'>
                            <div class="history-conversion">
                                ${this.formatNumber(item.fromValue)} ${this.getUnitSymbol(item.fromUnit)} → 
                                ${this.formatNumber(item.toValue)} ${this.getUnitSymbol(item.toUnit)}
                            </div>
                            <div class="history-time">${timeAgo} • ${this.capitalizeFirst(item.category)}</div>
                        </div>
                    `;
                }).join('');
            }

            renderFavorites() {
                if (this.favorites.length === 0) {
                    this.elements.favoritesList.innerHTML = `
                        <div class="favorite-item" data-conversion="length,1,meter,foot">1 m = 3.2808 ft</div>
                        <div class="favorite-item" data-conversion="weight,1,kilogram,pound">1 kg = 2.2046 lb</div>
                        <div class="favorite-item" data-conversion="temperature,0,celsius,fahrenheit">0°C = 32°F</div>
                    `;
                    return;
                }

                this.elements.favoritesList.innerHTML = this.favorites.map(item => `
                    <div class="favorite-item" data-favorite='${JSON.stringify(item)}'>
                        ${item.label}
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;">
                            ${this.capitalizeFirst(item.category)}
                        </div>
                    </div>
                `).join('');
            }

            loadFromHistory(element) {
                const historyData = JSON.parse(element.dataset.history);
                this.switchCategory(historyData.category);
                
                setTimeout(() => {
                    this.elements.fromValue.value = historyData.fromValue;
                    this.elements.fromUnit.value = historyData.fromUnit;
                    this.elements.toUnit.value = historyData.toUnit;
                    this.convert();
                }, 100);
                
                this.showToast('Loaded from history!');
            }

            loadFromFavorite(element) {
                const favoriteData = element.dataset.favorite;
                if (favoriteData) {
                    const favorite = JSON.parse(favoriteData);
                    this.switchCategory(favorite.category);
                    
                    setTimeout(() => {
                        this.elements.fromValue.value = favorite.fromValue;
                        this.elements.fromUnit.value = favorite.fromUnit;
                        this.elements.toUnit.value = favorite.toUnit;
                        this.convert();
                    }, 100);
                } else {
                    // Handle default favorites
                    const conversionData = element.dataset.conversion.split(',');
                    const [category, value, fromUnit, toUnit] = conversionData;
                    
                    this.switchCategory(category);
                    setTimeout(() => {
                        this.elements.fromValue.value = value;
                        this.elements.fromUnit.value = fromUnit;
                        this.elements.toUnit.value = toUnit;
                        this.convert();
                    }, 100);
                }
                
                this.showToast('Loaded favorite conversion!');
            }

            clearHistory() {
                this.conversionHistory = [];
                this.saveToStorage('conversionHistory', this.conversionHistory);
                this.renderHistory();
                this.showToast('History cleared!', 'success');
            }

            clearFavorites() {
                this.favorites = [];
                this.saveToStorage('favorites', this.favorites);
                this.renderFavorites();
                this.showToast('Favorites cleared!', 'success');
            }

            clearAll() {
                this.elements.fromValue.value = '';
                this.elements.toValue.value = '';
                this.elements.resultDisplay.style.display = 'none';
                this.elements.fromValue.focus();
                this.showToast('Values cleared!');
            }

            formatNumber(num) {
                if (num === 0) return '0';
                if (Math.abs(num) >= 1e6 || Math.abs(num) < 1e-3) {
                    return num.toExponential(this.precision);
                }
                
                // Remove trailing zeros
                return parseFloat(num.toFixed(this.precision)).toString();
            }

            getTimeAgo(date) {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins}m ago`;
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffDays < 7) return `${diffDays}d ago`;
                return date.toLocaleDateString();
            }

            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            showToast(message, type = 'success') {
                const toast = this.elements.toast;
                toast.textContent = message;
                toast.className = `toast ${type}`;
                toast.classList.add('show');

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            saveToStorage(key, data) {
                try {
                    // Note: In this demo, we're using a simple object store
                    // In a real application, this would use localStorage
                    if (!window.appStorage) window.appStorage = {};
                    window.appStorage[key] = JSON.stringify(data);
                } catch (error) {
                    console.warn('Storage not available:', error);
                }
            }

            loadFromStorage(key, defaultValue) {
                try {
                    if (!window.appStorage) window.appStorage = {};
                    const stored = window.appStorage[key];
                    return stored ? JSON.parse(stored) : defaultValue;
                } catch (error) {
                    console.warn('Storage not available:', error);
                    return defaultValue;
                }
            }
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new UnitConverterPro();
        });

        // Add some visual enhancements
        document.addEventListener('DOMContentLoaded', () => {
            // Add smooth scroll behavior
            document.documentElement.style.scrollBehavior = 'smooth';
            
            // Add loading animation on page load
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.5s ease-in-out';
            
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
        });
    </script>
</body>
</html>