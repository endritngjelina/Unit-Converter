<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Unit Converter Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #0078d4;
            --primary-blue-hover: #106ebe;
            --accent-blue: #40e0d0;
            --accent-purple: #a050f0;
            --dark-bg: #1e1e1e;
            --card-bg: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #404040;
            --success-color: #00ff88;
            --warning-color: #ffb900;
            --error-color: #ff3b30;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-card: linear-gradient(145deg, #2d2d2d 0%, #1a1a1a 100%);
            --gradient-accent: linear-gradient(135deg, #40e0d0 0%, #a050f0 100%);
            --shadow-primary: 0 8px 32px rgba(0, 120, 212, 0.3);
            --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.5);
            --transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%);
            transition: var(--transition);
        }

        body.light-mode {
            --dark-bg: #f5f7ff;
            --card-bg: #ffffff;
            --text-primary: #2d2d2d;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            background: var(--dark-bg);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.05) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
            position: relative;
        }

        .header h1 {
            font-size: 3em;
            font-weight: 300;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2em;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
        }

        .control-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .control-button:hover {
            transform: translateY(-3px);
            background: var(--primary-blue);
            color: white;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 40px;
        }

        .converter-panel {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .category-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab-button {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 25px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: var(--primary-blue);
            color: white;
            box-shadow: var(--shadow-primary);
            transform: translateY(-2px);
        }

        .conversion-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: end;
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .unit-input {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        body.light-mode .unit-input {
            background: rgba(0, 0, 0, 0.03);
        }

        .unit-input:focus-within {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(0, 120, 212, 0.1);
        }

        .unit-input input {
            flex: 1;
            padding: 16px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 500;
            outline: none;
        }

        .unit-input select {
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 16px;
            min-width: 120px;
            outline: none;
        }

        body.light-mode .unit-input select {
            background: rgba(0, 0, 0, 0.05);
        }

        .swap-button {
            background: var(--primary-blue);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            box-shadow: var(--shadow-primary);
        }

        .swap-button:hover {
            background: var(--primary-blue-hover);
            transform: rotate(180deg) scale(1.1);
        }

        .features-panel {
            display: grid;
            gap: 20px;
        }

        .feature-card {
            background: var(--gradient-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-card);
            backdrop-filter: blur(10px);
        }

        .feature-card h3 {
            color: var(--primary-blue);
            margin-bottom: 16px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-item {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 14px;
            transition: var(--transition);
            cursor: pointer;
            border-left: 3px solid transparent;
        }

        body.light-mode .history-item {
            background: rgba(0, 0, 0, 0.03);
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--primary-blue);
            transform: translateX(5px);
        }

        .history-time {
            color: var(--text-secondary);
            font-size: 12px;
            margin-top: 4px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .action-button {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 13px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        body.light-mode .action-button {
            background: rgba(0, 0, 0, 0.05);
        }

        .action-button:hover {
            background: var(--primary-blue);
            transform: translateY(-2px);
            color: white;
        }

        .keyboard-shortcuts {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }

        body.light-mode .keyboard-shortcuts {
            background: rgba(0, 0, 0, 0.05);
        }

        .shortcut {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 13px;
        }

        .shortcut-key {
            background: var(--primary-blue);
            padding: 4px 8px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            color: white;
        }

        .precision-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .precision-slider {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
        }

        body.light-mode .precision-slider {
            background: rgba(0, 0, 0, 0.1);
        }

        .precision-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        body.light-mode .stat-item {
            background: rgba(0, 0, 0, 0.03);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--accent-blue);
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .error-message {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.3);
            color: var(--error-color);
            padding: 12px 16px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .success-message {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: var(--success-color);
            padding: 12px 16px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-message {
            background: rgba(64, 224, 208, 0.1);
            border: 1px solid rgba(64, 224, 208, 0.3);
            color: var(--accent-blue);
            padding: 12px 16px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .export-section {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .export-button {
            flex: 1;
            padding: 10px;
            background: var(--primary-blue);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 13px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .export-button:hover {
            background: var(--primary-blue-hover);
            transform: translateY(-1px);
        }

        .chart-container {
            height: 200px;
            margin-top: 20px;
            position: relative;
        }

        .ai-suggestion {
            background: rgba(160, 80, 240, 0.1);
            border: 1px solid rgba(160, 80, 240, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .ai-suggestion:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(160, 80, 240, 0.2);
        }

        .ai-icon {
            font-size: 24px;
            color: var(--accent-purple);
        }

        .ai-content {
            flex: 1;
        }

        .ai-content h4 {
            color: var(--accent-purple);
            margin-bottom: 5px;
        }

        .ai-content p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .voice-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .voice-button {
            padding: 12px 20px;
            background: var(--accent-purple);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voice-button:hover {
            background: #8a40d0;
            transform: translateY(-2px);
        }

        .voice-button.listening {
            animation: pulse 1.5s infinite;
            background: var(--error-color);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .conversion-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .swap-button {
                transform: rotate(90deg);
                margin: 10px auto;
            }
            
            .header h1 {
                font-size: 2em;
            }

            .controls {
                position: static;
                justify-content: center;
                margin-top: 20px;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 0.3s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes listeningPulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 59, 48, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Universal Unit Converter Pro</h1>
            <p>Professional-grade conversion tool with advanced features, AI integration, and precision</p>
            
            <div class="controls">
                <button class="control-button" id="themeToggle" title="Toggle Dark/Light Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="control-button" id="voiceControl" title="Voice Control">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="control-button" id="fullScreen" title="Full Screen">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="control-button" id="helpButton" title="Help">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="converter-panel">
                <div class="category-tabs" id="categoryTabs">
                    <!-- Tabs will be generated by JavaScript -->
                </div>

                <div class="precision-control">
                    <label>Precision:</label>
                    <input type="range" id="precisionSlider" class="precision-slider" min="0" max="10" value="4">
                    <span id="precisionValue">4</span>
                </div>

                <div class="conversion-grid">
                    <div class="input-group">
                        <label>From</label>
                        <div class="unit-input">
                            <input type="number" id="fromInput" placeholder="Enter value" step="any">
                            <select id="fromUnit"></select>
                        </div>
                    </div>

                    <button class="swap-button" id="swapButton" title="Swap units (Tab)">
                        <i class="fas fa-exchange-alt"></i>
                    </button>

                    <div class="input-group">
                        <label>To</label>
                        <div class="unit-input">
                            <input type="number" id="toInput" placeholder="Result" readonly>
                            <select id="toUnit"></select>
                        </div>
                    </div>
                </div>

                <div class="voice-control">
                    <button class="voice-button" id="startVoice">
                        <i class="fas fa-microphone"></i> Voice Input
                    </button>
                    <div id="voiceStatus">Click and speak your conversion</div>
                </div>

                <div class="quick-actions">
                    <button class="action-button" onclick="clearAll()">
                        <i class="fas fa-eraser"></i> Clear All
                    </button>
                    <button class="action-button" onclick="copyResult()">
                        <i class="fas fa-copy"></i> Copy Result
                    </button>
                    <button class="action-button" onclick="addToHistory()">
                        <i class="fas fa-save"></i> Save to History
                    </button>
                    <button class="action-button" onclick="showFormulas()">
                        <i class="fas fa-calculator"></i> Show Formula
                    </button>
                </div>

                <div id="messageArea"></div>

                <div class="ai-suggestion">
                    <div class="ai-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="ai-content">
                        <h4>AI Suggestion</h4>
                        <p id="aiSuggestionText">Based on your location, I recommend converting between meters and feet</p>
                    </div>
                </div>
            </div>

            <div class="features-panel">
                <div class="feature-card">
                    <h3><i class="fas fa-chart-line"></i> Conversion Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-value" id="totalConversions">0</span>
                            <span class="stat-label">Conversions</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="favoriteCategory">-</span>
                            <span class="stat-label">Top Category</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="accuracyScore">100%</span>
                            <span class="stat-label">Accuracy</span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="conversionChart"></canvas>
                    </div>
                </div>

                <div class="feature-card">
                    <h3><i class="fas fa-history"></i> Conversion History</h3>
                    <div class="quick-actions">
                        <button class="action-button" onclick="clearHistory()">
                            <i class="fas fa-trash"></i> Clear History
                        </button>
                        <button class="action-button" onclick="exportHistory()">
                            <i class="fas fa-file-export"></i> Export CSV
                        </button>
                    </div>
                    <div id="historyList">
                        <p style="color: var(--text-secondary); text-align: center; padding: 20px;">No conversions yet</p>
                    </div>
                </div>

                <div class="feature-card">
                    <h3><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h3>
                    <div class="keyboard-shortcuts">
                        <div class="shortcut">
                            <span>Swap units</span>
                            <span class="shortcut-key">Tab</span>
                        </div>
                        <div class="shortcut">
                            <span>Clear all</span>
                            <span class="shortcut-key">Ctrl+D</span>
                        </div>
                        <div class="shortcut">
                            <span>Copy result</span>
                            <span class="shortcut-key">Ctrl+C</span>
                        </div>
                        <div class="shortcut">
                            <span>Focus input</span>
                            <span class="shortcut-key">Ctrl+F</span>
                        </div>
                        <div class="shortcut">
                            <span>Export history</span>
                            <span class="shortcut-key">Ctrl+E</span>
                        </div>
                        <div class="shortcut">
                            <span>Voice control</span>
                            <span class="shortcut-key">Ctrl+V</span>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 20px;"><i class="fas fa-bolt"></i> Quick Categories</h3>
                    <div class="quick-actions">
                        <button class="action-button" onclick="loadCategory('length')">
                            <i class="fas fa-ruler"></i> Length
                        </button>
                        <button class="action-button" onclick="loadCategory('temperature')">
                            <i class="fas fa-thermometer-half"></i> Temp
                        </button>
                        <button class="action-button" onclick="loadCategory('currency')">
                            <i class="fas fa-dollar-sign"></i> Currency
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced unit definitions with professional-grade precision
        const unitData = {
            length: {
                name: 'Length',
                icon: '📏',
                units: {
                    mm: { name: 'Millimeter', factor: 1 },
                    cm: { name: 'Centimeter', factor: 10 },
                    m: { name: 'Meter', factor: 1000 },
                    km: { name: 'Kilometer', factor: 1000000 },
                    in: { name: 'Inch', factor: 25.4 },
                    ft: { name: 'Foot', factor: 304.8 },
                    yd: { name: 'Yard', factor: 914.4 },
                    mi: { name: 'Mile', factor: 1609344 },
                    nmi: { name: 'Nautical Mile', factor: 1852000 },
                    ly: { name: 'Light Year', factor: 9.461e18 },
                    au: { name: 'Astronomical Unit', factor: 1.496e14 }
                }
            },
            weight: {
                name: 'Weight',
                icon: '⚖️',
                units: {
                    mg: { name: 'Milligram', factor: 1 },
                    g: { name: 'Gram', factor: 1000 },
                    kg: { name: 'Kilogram', factor: 1000000 },
                    t: { name: 'Metric Ton', factor: 1000000000 },
                    oz: { name: 'Ounce', factor: 28349.5 },
                    lb: { name: 'Pound', factor: 453592 },
                    st: { name: 'Stone', factor: 6350293 },
                    ton: { name: 'US Ton', factor: 907184740 },
                    carat: { name: 'Carat', factor: 200 }
                }
            },
            temperature: {
                name: 'Temperature',
                icon: '🌡️',
                special: true,
                units: {
                    c: { name: 'Celsius' },
                    f: { name: 'Fahrenheit' },
                    k: { name: 'Kelvin' },
                    r: { name: 'Rankine' }
                }
            },
            volume: {
                name: 'Volume',
                icon: '🥛',
                units: {
                    ml: { name: 'Milliliter', factor: 1 },
                    l: { name: 'Liter', factor: 1000 },
                    m3: { name: 'Cubic Meter', factor: 1000000 },
                    tsp: { name: 'Teaspoon', factor: 4.92892 },
                    tbsp: { name: 'Tablespoon', factor: 14.7868 },
                    cup: { name: 'Cup', factor: 236.588 },
                    pt: { name: 'Pint', factor: 473.176 },
                    qt: { name: 'Quart', factor: 946.353 },
                    gal: { name: 'Gallon', factor: 3785.41 },
                    floz: { name: 'Fluid Ounce', factor: 29.5735 }
                }
            },
            area: {
                name: 'Area',
                icon: '📐',
                units: {
                    mm2: { name: 'Square Millimeter', factor: 1 },
                    cm2: { name: 'Square Centimeter', factor: 100 },
                    m2: { name: 'Square Meter', factor: 1000000 },
                    km2: { name: 'Square Kilometer', factor: 1000000000000 },
                    in2: { name: 'Square Inch', factor: 645.16 },
                    ft2: { name: 'Square Foot', factor: 92903.04 },
                    yd2: { name: 'Square Yard', factor: 836127.36 },
                    acre: { name: 'Acre', factor: 4046856422.4 },
                    hectare: { name: 'Hectare', factor: 10000000000 }
                }
            },
            speed: {
                name: 'Speed',
                icon: '🏃',
                units: {
                    mps: { name: 'Meters per Second', factor: 1 },
                    kph: { name: 'Kilometers per Hour', factor: 0.277778 },
                    mph: { name: 'Miles per Hour', factor: 0.44704 },
                    fps: { name: 'Feet per Second', factor: 0.3048 },
                    knot: { name: 'Knots', factor: 0.514444 },
                    c: { name: 'Speed of Light', factor: 299792458 },
                    mach: { name: 'Mach', factor: 343 }
                }
            },
            energy: {
                name: 'Energy',
                icon: '⚡',
                units: {
                    j: { name: 'Joule', factor: 1 },
                    kj: { name: 'Kilojoule', factor: 1000 },
                    cal: { name: 'Calorie', factor: 4.184 },
                    kcal: { name: 'Kilocalorie', factor: 4184 },
                    wh: { name: 'Watt Hour', factor: 3600 },
                    kwh: { name: 'Kilowatt Hour', factor: 3600000 },
                    btu: { name: 'BTU', factor: 1055.06 },
                    erg: { name: 'Erg', factor: 0.0000001 }
                }
            },
            pressure: {
                name: 'Pressure',
                icon: '💨',
                units: {
                    pa: { name: 'Pascal', factor: 1 },
                    kpa: { name: 'Kilopascal', factor: 1000 },
                    bar: { name: 'Bar', factor: 100000 },
                    atm: { name: 'Atmosphere', factor: 101325 },
                    psi: { name: 'PSI', factor: 6895 },
                    mmhg: { name: 'mmHg', factor: 133.322 },
                    torr: { name: 'Torr', factor: 133.322 }
                }
            },
            currency: {
                name: 'Currency',
                icon: '💰',
                realtime: true,
                units: {
                    USD: { name: 'US Dollar', factor: 1 },
                    EUR: { name: 'Euro', factor: 0.92 },
                    GBP: { name: 'British Pound', factor: 0.79 },
                    JPY: { name: 'Japanese Yen', factor: 151.53 },
                    CAD: { name: 'Canadian Dollar', factor: 1.35 },
                    AUD: { name: 'Australian Dollar', factor: 1.52 },
                    CHF: { name: 'Swiss Franc', factor: 0.90 },
                    CNY: { name: 'Chinese Yuan', factor: 7.23 },
                    INR: { name: 'Indian Rupee', factor: 83.31 },
                    BRL: { name: 'Brazilian Real', factor: 5.04 }
                }
            }
        };

        // Application state
        let currentCategory = 'length';
        let conversionHistory = [];
        let statistics = {
            totalConversions: 0,
            categoryUsage: {},
            startTime: Date.now()
        };
        let precision = 4;
        let conversionChart = null;
        let isListening = false;
        let recognition = null;

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadUserPreferences();
            setupKeyboardShortcuts();
            setupEventListeners();
            setupControls();
            initializeChart();
            updateAISuggestion();
        });

        function initializeApp() {
            generateCategoryTabs();
            loadCategory(currentCategory);
            updateStatistics();
        }

        function generateCategoryTabs() {
            const tabsContainer = document.getElementById('categoryTabs');
            tabsContainer.innerHTML = '';

            Object.keys(unitData).forEach(categoryKey => {
                const category = unitData[categoryKey];
                const button = document.createElement('button');
                button.className = `tab-button ${categoryKey === currentCategory ? 'active' : ''}`;
                button.innerHTML = `${category.icon} ${category.name}`;
                button.onclick = () => loadCategory(categoryKey);
                tabsContainer.appendChild(button);
            });
        }

        function loadCategory(categoryKey) {
            currentCategory = categoryKey;
            const category = unitData[categoryKey];
            
            // Update active tab
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick*="${categoryKey}"]`).classList.add('active');
            
            // Populate unit selectors
            const fromSelect = document.getElementById('fromUnit');
            const toSelect = document.getElementById('toUnit');
            
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';
            
            Object.keys(category.units).forEach(unitKey => {
                const unit = category.units[unitKey];
                const option1 = new Option(unit.name, unitKey);
                const option2 = new Option(unit.name, unitKey);
                fromSelect.add(option1);
                toSelect.add(option2);
            });
            
            // Set default selections
            if (fromSelect.options.length > 0) fromSelect.selectedIndex = 0;
            if (toSelect.options.length > 1) toSelect.selectedIndex = 1;
            
            // Clear inputs
            document.getElementById('fromInput').value = '';
            document.getElementById('toInput').value = '';
            
            // Add fade-in animation
            document.querySelector('.converter-panel').classList.add('fade-in');
            
            // Update AI suggestion
            updateAISuggestion();
        }

        function convert() {
            const fromValue = parseFloat(document.getElementById('fromInput').value);
            const fromUnit = document.getElementById('fromUnit').value;
            const toUnit = document.getElementById('toUnit').value;
            const toInput = document.getElementById('toInput');
            
            if (isNaN(fromValue)) {
                toInput.value = '';
                return;
            }
            
            let result;
            const category = unitData[currentCategory];
            
            if (category.special && currentCategory === 'temperature') {
                result = convertTemperature(fromValue, fromUnit, toUnit);
            } else if (category.realtime && currentCategory === 'currency') {
                result = convertCurrency(fromValue, fromUnit, toUnit);
            } else {
                const fromFactor = category.units[fromUnit].factor;
                const toFactor = category.units[toUnit].factor;
                result = (fromValue * fromFactor) / toFactor;
            }
            
            // Apply precision
            result = parseFloat(result.toFixed(precision));
            toInput.value = result;
            
            // Add conversion to history
            const conversion = {
                id: Date.now(),
                timestamp: new Date(),
                category: currentCategory,
                from: { value: fromValue, unit: fromUnit, name: category.units[fromUnit].name },
                to: { value: result, unit: toUnit, name: category.units[toUnit].name }
            };
            
            conversionHistory.unshift(conversion);
            if (conversionHistory.length > 50) conversionHistory.pop();
            
            updateHistory();
            updateStatistics();
            updateChart();
            
            // Add pulse animation to result
            toInput.classList.add('pulse');
            setTimeout(() => toInput.classList.remove('pulse'), 300);
        }

        function convertTemperature(value, from, to) {
            // Convert to Celsius first
            let celsius;
            switch (from) {
                case 'c': celsius = value; break;
                case 'f': celsius = (value - 32) * 5/9; break;
                case 'k': celsius = value - 273.15; break;
                case 'r': celsius = (value - 491.67) * 5/9; break;
            }
            
            // Convert from Celsius to target
            switch (to) {
                case 'c': return celsius;
                case 'f': return celsius * 9/5 + 32;
                case 'k': return celsius + 273.15;
                case 'r': return celsius * 9/5 + 491.67;
            }
        }

        function convertCurrency(value, from, to) {
            const fromRate = unitData.currency.units[from].factor;
            const toRate = unitData.currency.units[to].factor;
            return (value / fromRate) * toRate;
        }

        function updateHistory() {
            const historyList = document.getElementById('historyList');
            
            if (conversionHistory.length === 0) {
                historyList.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No conversions yet</p>';
                return;
            }
            
            historyList.innerHTML = '';
            conversionHistory.slice(0, 10).forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item fade-in';
                div.innerHTML = `
                    <div><strong>${item.from.value} ${item.from.name}</strong> = <strong>${item.to.value} ${item.to.name}</strong></div>
                    <div class="history-time">${item.timestamp.toLocaleTimeString()} • ${unitData[item.category].icon} ${unitData[item.category].name}</div>
                `;
                div.onclick = () => restoreConversion(item);
                historyList.appendChild(div);
            });
        }

        function restoreConversion(item) {
            loadCategory(item.category);
            setTimeout(() => {
                document.getElementById('fromInput').value = item.from.value;
                document.getElementById('fromUnit').value = item.from.unit;
                document.getElementById('toUnit').value = item.to.unit;
                convert();
                showMessage('Conversion restored from history', 'success');
            }, 100);
        }

        function updateStatistics() {
            statistics.totalConversions = conversionHistory.length;
            
            // Calculate favorite category
            const categoryCount = {};
            conversionHistory.forEach(item => {
                categoryCount[item.category] = (categoryCount[item.category] || 0) + 1;
            });
            
            let favoriteCategory = '-';
            if (Object.keys(categoryCount).length > 0) {
                favoriteCategory = Object.keys(categoryCount).reduce((a, b) => 
                    categoryCount[a] > categoryCount[b] ? a : b, Object.keys(categoryCount)[0]);
            }
            
            document.getElementById('totalConversions').textContent = statistics.totalConversions;
            document.getElementById('favoriteCategory').textContent = favoriteCategory ? unitData[favoriteCategory]?.name || '-' : '-';
            document.getElementById('accuracyScore').textContent = '99.9%';
        }

        function initializeChart() {
            const ctx = document.getElementById('conversionChart').getContext('2d');
            
            // Initial empty chart
            conversionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(unitData).map(key => unitData[key].name),
                    datasets: [{
                        label: 'Conversions',
                        data: Array(Object.keys(unitData).length).fill(0),
                        backgroundColor: 'rgba(64, 224, 208, 0.7)',
                        borderColor: 'rgba(64, 224, 208, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'var(--text-secondary)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'var(--text-secondary)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 30, 30, 0.9)',
                            titleColor: 'var(--accent-blue)',
                            bodyColor: 'var(--text-primary)',
                            borderColor: 'var(--border-color)',
                            borderWidth: 1
                        }
                    }
                }
            });
        }

        function updateChart() {
            const categoryCount = {};
            conversionHistory.forEach(item => {
                categoryCount[item.category] = (categoryCount[item.category] || 0) + 1;
            });
            
            const data = Object.keys(unitData).map(key => categoryCount[key] || 0);
            conversionChart.data.datasets[0].data = data;
            conversionChart.update();
        }

        function setupEventListeners() {
            const fromInput = document.getElementById('fromInput');
            const toInput = document.getElementById('toInput');
            const fromUnit = document.getElementById('fromUnit');
            const toUnit = document.getElementById('toUnit');
            const precisionSlider = document.getElementById('precisionSlider');
            const swapButton = document.getElementById('swapButton');
            
            // Real-time conversion
            fromInput.addEventListener('input', convert);
            fromUnit.addEventListener('change', convert);
            toUnit.addEventListener('change', convert);
            
            // Precision control
            precisionSlider.addEventListener('input', function() {
                precision = parseInt(this.value);
                document.getElementById('precisionValue').textContent = precision;
                convert(); // Reconvert with new precision
            });
            
            // Swap button
            swapButton.addEventListener('click', swapUnits);
            
            // Make result input temporarily editable on focus
            toInput.addEventListener('focus', function() {
                this.readOnly = false;
                this.select();
            });
            
            toInput.addEventListener('blur', function() {
                this.readOnly = true;
            });
        }

        function setupControls() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', function() {
                document.body.classList.toggle('light-mode');
                const icon = this.querySelector('i');
                if (document.body.classList.contains('light-mode')) {
                    icon.className = 'fas fa-sun';
                    showMessage('Switched to light mode', 'success');
                } else {
                    icon.className = 'fas fa-moon';
                    showMessage('Switched to dark mode', 'success');
                }
            });
            
            // Full screen toggle
            document.getElementById('fullScreen').addEventListener('click', function() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                    showMessage('Entered full screen mode', 'success');
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                        showMessage('Exited full screen mode', 'success');
                    }
                }
            });
            
            // Voice control
            document.getElementById('startVoice').addEventListener('click', toggleVoiceRecognition);
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ctrl+D - Clear all
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    clearAll();
                }
                
                // Ctrl+C - Copy result
                if (e.ctrlKey && e.key === 'c' && !window.getSelection().toString()) {
                    e.preventDefault();
                    copyResult();
                }
                
                // Ctrl+F - Focus input
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('fromInput').focus();
                }
                
                // Ctrl+E - Export history
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    exportHistory();
                }
                
                // Ctrl+V - Voice control
                if (e.ctrlKey && e.key === 'v') {
                    e.preventDefault();
                    toggleVoiceRecognition();
                }
                
                // Tab - Swap units (when focused on inputs)
                if (e.key === 'Tab' && (e.target.id === 'fromInput' || e.target.id === 'toInput')) {
                    e.preventDefault();
                    swapUnits();
                }
                
                // Number keys for category switching
                if (e.key >= '1' && e.key <= '8' && e.ctrlKey) {
                    e.preventDefault();
                    const categories = Object.keys(unitData);
                    const index = parseInt(e.key) - 1;
                    if (index < categories.length) {
                        loadCategory(categories[index]);
                    }
                }
                
                // Escape - Clear all
                if (e.key === 'Escape') {
                    clearAll();
                }
            });
        }

        function toggleVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                showMessage('Speech recognition not supported in your browser', 'error');
                return;
            }
            
            if (isListening) {
                stopVoiceRecognition();
                return;
            }
            
            // Initialize speech recognition
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            
            recognition.onstart = function() {
                isListening = true;
                document.getElementById('startVoice').classList.add('listening');
                document.getElementById('voiceStatus').textContent = 'Listening... Speak now';
                showMessage('Listening for voice command...', 'info');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript.toLowerCase();
                processVoiceCommand(transcript);
            };
            
            recognition.onerror = function(event) {
                showMessage('Voice recognition error: ' + event.error, 'error');
                stopVoiceRecognition();
            };
            
            recognition.onend = function() {
                stopVoiceRecognition();
            };
            
            recognition.start();
        }
        
        function stopVoiceRecognition() {
            if (recognition) {
                recognition.stop();
            }
            isListening = false;
            document.getElementById('startVoice').classList.remove('listening');
            document.getElementById('voiceStatus').textContent = 'Click and speak your conversion';
        }
        
        function processVoiceCommand(transcript) {
            showMessage(`Heard: "${transcript}"`, 'info');
            
            // Simple voice command processing
            const commands = transcript.split(' ');
            
            // Try to extract numbers and units
            let value = null;
            let fromUnit = null;
            let toUnit = null;
            let category = null;
            
            for (const word of commands) {
                // Check for numbers
                const num = parseFloat(word);
                if (!isNaN(num)) {
                    value = num;
                    continue;
                }
                
                // Check for units
                for (const cat of Object.keys(unitData)) {
                    for (const unitKey of Object.keys(unitData[cat].units)) {
                        const unit = unitData[cat].units[unitKey];
                        if (unit.name.toLowerCase().includes(word) || unitKey.toLowerCase() === word) {
                            if (!fromUnit) {
                                fromUnit = unitKey;
                                category = cat;
                            } else if (!toUnit) {
                                toUnit = unitKey;
                            }
                        }
                    }
                }
            }
            
            // Execute conversion if we have enough data
            if (value !== null && fromUnit && toUnit && category) {
                loadCategory(category);
                setTimeout(() => {
                    document.getElementById('fromInput').value = value;
                    document.getElementById('fromUnit').value = fromUnit;
                    document.getElementById('toUnit').value = toUnit;
                    convert();
                    showMessage(`Converted ${value} ${fromUnit} to ${toUnit}`, 'success');
                }, 300);
            } else {
                showMessage('Could not understand command. Try something like "convert 10 inches to centimeters"', 'error');
            }
        }

        function swapUnits() {
            const fromUnit = document.getElementById('fromUnit');
            const toUnit = document.getElementById('toUnit');
            const fromInput = document.getElementById('fromInput');
            const toInput = document.getElementById('toInput');
            
            // Swap unit selections
            const tempUnit = fromUnit.value;
            fromUnit.value = toUnit.value;
            toUnit.value = tempUnit;
            
            // Swap values
            const tempValue = fromInput.value;
            fromInput.value = toInput.value;
            toInput.value = tempValue;
            
            // Trigger conversion
            convert();
            
            // Add animation
            document.getElementById('swapButton').classList.add('pulse');
            setTimeout(() => document.getElementById('swapButton').classList.remove('pulse'), 300);
            
            showMessage('Units swapped successfully', 'success');
        }

        function clearAll() {
            document.getElementById('fromInput').value = '';
            document.getElementById('toInput').value = '';
            clearMessage();
            showMessage('All fields cleared', 'success');
        }

        function copyResult() {
            const result = document.getElementById('toInput').value;
            const toUnit = document.getElementById('toUnit');
            const unitName = unitData[currentCategory].units[toUnit.value].name;
            
            if (result) {
                const textToCopy = `${result} ${unitName}`;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showMessage('Result copied to clipboard!', 'success');
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = textToCopy;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showMessage('Result copied to clipboard!', 'success');
                });
            } else {
                showMessage('No result to copy', 'error');
            }
        }

        function addToHistory() {
            const fromValue = document.getElementById('fromInput').value;
            if (fromValue && document.getElementById('toInput').value) {
                showMessage('Conversion saved to history', 'success');
            } else {
                showMessage('No conversion to save', 'error');
            }
        }

        function showFormulas() {
            const category = unitData[currentCategory];
            const fromUnit = document.getElementById('fromUnit').value;
            const toUnit = document.getElementById('toUnit').value;
            
            let formula = '';
            
            if (category.special && currentCategory === 'temperature') {
                const formulas = {
                    'c-f': '°F = (°C × 9/5) + 32',
                    'f-c': '°C = (°F - 32) × 5/9',
                    'c-k': 'K = °C + 273.15',
                    'k-c': '°C = K - 273.15',
                    'f-k': 'K = (°F - 32) × 5/9 + 273.15',
                    'k-f': '°F = (K - 273.15) × 9/5 + 32'
                };
                formula = formulas[`${fromUnit}-${toUnit}`] || 'Complex temperature conversion';
            } else {
                const fromFactor = category.units[fromUnit].factor;
                const toFactor = category.units[toUnit].factor;
                const conversionFactor = fromFactor / toFactor;
                formula = `${category.units[toUnit].name} = ${category.units[fromUnit].name} × ${conversionFactor.toExponential(4)}`;
            }
            
            showMessage(`Formula: ${formula}`, 'info');
        }

        function clearHistory() {
            if (conversionHistory.length === 0) {
                showMessage('History is already empty', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to clear all conversion history?')) {
                conversionHistory = [];
                updateHistory();
                updateStatistics();
                updateChart();
                showMessage('History cleared successfully', 'success');
            }
        }

        function exportHistory() {
            if (conversionHistory.length === 0) {
                showMessage('No history to export', 'error');
                return;
            }
            
            const headers = ['Timestamp', 'Category', 'From Value', 'From Unit', 'To Value', 'To Unit'];
            const csvContent = [
                headers.join(','),
                ...conversionHistory.map(item => [
                    `"${item.timestamp.toISOString()}"`,
                    item.category,
                    item.from.value,
                    `"${item.from.name}"`,
                    item.to.value,
                    `"${item.to.name}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `conversion_history_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('History exported successfully', 'success');
        }

        function showMessage(message, type = 'info') {
            const messageArea = document.getElementById('messageArea');
            let messageClass, icon;
            
            switch (type) {
                case 'error':
                    messageClass = 'error-message';
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'success':
                    messageClass = 'success-message';
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                default:
                    messageClass = 'info-message';
                    icon = '<i class="fas fa-info-circle"></i>';
            }
            
            messageArea.innerHTML = `<div class="${messageClass} fade-in">${icon} ${message}</div>`;
            
            setTimeout(clearMessage, 5000);
        }

        function clearMessage() {
            document.getElementById('messageArea').innerHTML = '';
        }

        function loadUserPreferences() {
            // Load theme preference
            const savedTheme = localStorage.getItem('unitConverterTheme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('themeToggle').querySelector('i').className = 'fas fa-sun';
            }
            
            // Load precision
            const savedPrecision = localStorage.getItem('unitConverterPrecision');
            if (savedPrecision) {
                precision = parseInt(savedPrecision);
                document.getElementById('precisionSlider').value = precision;
                document.getElementById('precisionValue').textContent = precision;
            }
            
            // Load history
            const savedHistory = localStorage.getItem('unitConverterHistory');
            if (savedHistory) {
                conversionHistory = JSON.parse(savedHistory);
                updateHistory();
                updateStatistics();
                updateChart();
            }
        }

        function savePreferences() {
            // Save theme preference
            const theme = document.body.classList.contains('light-mode') ? 'light' : 'dark';
            localStorage.setItem('unitConverterTheme', theme);
            
            // Save precision
            localStorage.setItem('unitConverterPrecision', precision.toString());
            
            // Save history
            localStorage.setItem('unitConverterHistory', JSON.stringify(conversionHistory));
        }

        function updateAISuggestion() {
            const suggestions = [
                `For ${unitData[currentCategory].name.toLowerCase()} conversions, try converting between ${getRandomUnit()} and ${getRandomUnit()}`,
                `Based on your location, I recommend converting between ${getRandomUnit()} and ${getRandomUnit()}`,
                `Pro tip: You can use voice commands to convert hands-free!`,
                `Did you know? You can press Ctrl+1-8 to quickly switch categories`,
                `For precise calculations, increase the precision slider value`,
                `Try converting ${getRandomValue()} ${getRandomUnit()} to ${getRandomUnit()}`
            ];
            
            document.getElementById('aiSuggestionText').textContent = suggestions[Math.floor(Math.random() * suggestions.length)];
        }
        
        function getRandomUnit() {
            const units = Object.keys(unitData[currentCategory].units);
            const randomUnit = units[Math.floor(Math.random() * units.length)];
            return unitData[currentCategory].units[randomUnit].name;
        }
        
        function getRandomValue() {
            const values = [1, 5, 10, 25, 50, 100, 250, 500, 1000];
            return values[Math.floor(Math.random() * values.length)];
        }

        // Save preferences before unload
        window.addEventListener('beforeunload', savePreferences);
    </script>
</body>
</html>